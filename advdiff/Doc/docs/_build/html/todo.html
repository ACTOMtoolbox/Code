<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Todo &mdash; Advection-Diffusion Module 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/my_theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Maintaining the documentation" href="maintaining_documentation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Advection-Diffusion Module
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Content:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About AdvDiff</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup.ini</a></li>
<li class="toctree-l1"><a class="reference internal" href="boundary_conditions.html">Boundary conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpolator.html">Interpolation with meshA_to_meshB</a></li>
<li class="toctree-l1"><a class="reference internal" href="mesh_types.html">Different mesh-types</a></li>
<li class="toctree-l1"><a class="reference internal" href="coordinates.html">Coordinate transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="synthetic_translation.html">Synthetic translation</a></li>
<li class="toctree-l1"><a class="reference internal" href="code.html">Code API</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools API</a></li>
<li class="toctree-l1"><a class="reference internal" href="maintaining_documentation.html">Maintaining the documentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Todo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#improving-performance">Improving performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#uniformity-of-inputs-and-outputs">Uniformity of inputs and outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dealing-with-coastlines-islands-and-other-landmasses">Dealing with coastlines, islands and other landmasses</a></li>
<li class="toctree-l2"><a class="reference internal" href="#investigating-the-diriclet-boundary-condition">Investigating the Diriclet boundary condition</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Advection-Diffusion Module</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Todo</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/todo.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="todo">
<h1>Todo<a class="headerlink" href="#todo" title="Permalink to this headline"></a></h1>
<div class="section" id="improving-performance">
<h2>Improving performance<a class="headerlink" href="#improving-performance" title="Permalink to this headline"></a></h2>
<p>The default run-time configuration of FiPy is based on the available packages that are installed on the machine.
To override the default behaviour, command-line flags can be used. The –inline flag is causes
many mathematical operations to be computed through C instead of Python, which can improve the performance.
However, for this flag to work, the Weaver package has to be installed. Unfortunately, Weaver is not available on Python 3.x,
and thus I have been unable to get –inline to work.</p>
<p>In addition to this, FiPy can use several different solvers. The solvers include “petsc”, “scipy”, “pysparse”, and “trilinos”.
This version of AdvDiff runs with the scipy solver, however it is also the slowest solver of the bunch.
Unfortunately, I have been unable to get any of the other solvers to work with version 3.8 of Python.</p>
<p>If you are able to install Weaver and/or get any of the other solvers to work with Python 3.8, then you may gain some performance improvements.
Alternatively, you could look into porting AdvDiff over to another version of Python that supports the other solvers.</p>
</div>
<div class="section" id="uniformity-of-inputs-and-outputs">
<h2>Uniformity of inputs and outputs<a class="headerlink" href="#uniformity-of-inputs-and-outputs" title="Permalink to this headline"></a></h2>
<p>One possible issue with AdvDiff that shoule be rectified, is uniformity between input and output data.
FiPy solvers work on unstructured data, however xarray works much better with structured data.
You can store unstructured data with xarray just fine, but much of the nice xarray functionality will not work as well.
Such as easily being able to generate plots, interpolate multiple grids together, etc.
As such, we have constructed the AdvDiff module to generate solutions on an unstructured set of data, to then be interpolated onto a structured grid
which are then stored in xarray dataset. In short:</p>
<ul class="simple">
<li><p>User gives the AdvDiff solver input data in an unstructured form <span class="math notranslate nohighlight">\(F(t,num)\)</span> where <strong>num</strong> is the gridcell id of an unstructured set of data.</p></li>
<li><p>FiPy generates solution of the form <span class="math notranslate nohighlight">\(C(t,num)\)</span>.</p></li>
<li><p>The unstructured solution is then interpolated onto a structured grid of the form <span class="math notranslate nohighlight">\(C(t,x,y)\)</span>.</p></li>
<li><p>The structured solution is then stored to a netcdf file via xarray.</p></li>
</ul>
<p>We see that it may be confusing to the user that input data needs to be given in terms of an unstructured set of data, while the output will always be in terms of
structured dataset. To fix this, we have developed an alternate approach. In short:</p>
<ul class="simple">
<li><p>User gives the AdvDiff solver input data in an unstructured form <span class="math notranslate nohighlight">\(F(t,num)\)</span> where <strong>num</strong> is the gridcell id of an unstructured set of data.</p></li>
<li><p>FiPy generates solution of the form <span class="math notranslate nohighlight">\(C(t,num)\)</span>.</p></li>
<li><p>The unstructured solution is then stored to a netcdf file via xarray.</p></li>
<li><p>A post-processing module is then used to interpolate the data <span class="math notranslate nohighlight">\(C(t,num)\)</span> and reformat the unstructured xarray file to represent the solution in terms of <span class="math notranslate nohighlight">\(C(t,x,y)\)</span>.</p></li>
</ul>
<p>The former solution has the benefit of only needing to parse the data and interpolate once during runtime, while the latter solution
has the benefit of unifying input and output formats. Either solution works well, but it is up to the discretion of the future developer to decide what method
is best.</p>
</div>
<div class="section" id="dealing-with-coastlines-islands-and-other-landmasses">
<h2>Dealing with coastlines, islands and other landmasses<a class="headerlink" href="#dealing-with-coastlines-islands-and-other-landmasses" title="Permalink to this headline"></a></h2>
<p>The AdvDiff module works best on the open ocean or away from islands or coastlines that could affect the solution.
This is because there is no special consideration of landmasses in the solver.
At the current moment, if the velocity data contains any NANs (typical for locations where there is land), then these locations will be filled with
zero velocities. This is to simulate a no flux boundary on land. This is obviously only a rough approximation, but it was the simplest to implement.
As such, if a significant amount of tracer moves rapidly onto the coastline, it may get stuck there due to the zero velocity at these locations.
If you want to change this behaviour, check the <strong>fillna()</strong> method in the <strong>treat_xy_velocity()</strong> and <strong>treat_sparse_velocity()</strong> functions in <a class="reference internal" href="file_loader.html"><span class="doc">file_loader.py module</span></a>.</p>
<p>One option for the future developer is to generate a mask based on locations in space that contain land, then using this mask to set no-flux, Diriclet or Robin
boundary conditions on this mask. This should be possible by using the <strong>where</strong> keyword in FiPy when setting boundary conditions or defining variables, but this has never been tested.</p>
</div>
<div class="section" id="investigating-the-diriclet-boundary-condition">
<h2>Investigating the Diriclet boundary condition<a class="headerlink" href="#investigating-the-diriclet-boundary-condition" title="Permalink to this headline"></a></h2>
<p>The Dirichlet boundary condition behaves strangely. This should be investigated as it could reveal some underlying problem.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="maintaining_documentation.html" class="btn btn-neutral float-left" title="Maintaining the documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, ACTOM.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>