<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>local_variable_treatment module &mdash; Advection-Diffusion Module 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/my_theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="parser_tools module" href="parser_tools.html" />
    <link rel="prev" title="risk_to_positions module" href="risk_to_positions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Advection-Diffusion Module
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Content:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About AdvDiff</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup.ini</a></li>
<li class="toctree-l1"><a class="reference internal" href="boundary_conditions.html">Boundary conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpolator.html">Interpolation with meshA_to_meshB</a></li>
<li class="toctree-l1"><a class="reference internal" href="mesh_types.html">Different mesh-types</a></li>
<li class="toctree-l1"><a class="reference internal" href="coordinates.html">Coordinate transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="synthetic_translation.html">Synthetic translation</a></li>
<li class="toctree-l1"><a class="reference internal" href="code.html">Code API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tools.html">Tools API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="coord_transform.html">coord_transform module</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_processing.html">data_processing module</a></li>
<li class="toctree-l2"><a class="reference internal" href="post_processing.html">post_processing module</a></li>
<li class="toctree-l2"><a class="reference internal" href="file_loader.html">file_loader module</a></li>
<li class="toctree-l2"><a class="reference internal" href="mesh_generator.html">mesh_generator module</a></li>
<li class="toctree-l2"><a class="reference internal" href="interpolator_module.html">interpolator module</a></li>
<li class="toctree-l2"><a class="reference internal" href="risk_to_positions.html">risk_to_positions module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">local_variable_treatment module</a></li>
<li class="toctree-l2"><a class="reference internal" href="parser_tools.html">parser_tools module</a></li>
<li class="toctree-l2"><a class="reference internal" href="directory_tools.html">directory_tools module</a></li>
<li class="toctree-l2"><a class="reference internal" href="visualizer_tools.html">visualizer_tools module</a></li>
<li class="toctree-l2"><a class="reference internal" href="scenario_creator.html">scenario_creator module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="maintaining_documentation.html">Maintaining the documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">Todo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Advection-Diffusion Module</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="tools.html">Tools API</a> &raquo;</li>
      <li>local_variable_treatment module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/local_variable_treatment.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="module-local_variable_treatment">
<span id="local-variable-treatment-module"></span><h1>local_variable_treatment module<a class="headerlink" href="#module-local_variable_treatment" title="Permalink to this headline"></a></h1>
<p>&#64;author: Ketil</p>
<p>This module defines the global_to_local_variables class, with a number of methods.
The global_to_local_variables class module extracts the relevant local variables from the global ones for use in AdvDiff.</p>
<dl class="py class">
<dt class="sig sig-object py" id="local_variable_treatment.global_to_local_variables">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">local_variable_treatment.</span></span><span class="sig-name descname"><span class="pre">global_to_local_variables</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">global_velocity</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sources</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">probes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meshdict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#local_variable_treatment.global_to_local_variables" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="local_variable_treatment.global_to_local_variables.extract_and_interpolate_velocity">
<span class="sig-name descname"><span class="pre">extract_and_interpolate_velocity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xmid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ymid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extrap_from_A</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#local_variable_treatment.global_to_local_variables.extract_and_interpolate_velocity" title="Permalink to this definition"></a></dt>
<dd><p>Interpolates the velocity dataset onto the computational mesh which will be used by the fipy solver.
Interpolation is done using linear meshA_to_meshB interpolator. Any NAN values encountered during
interpolation may be extrapolated using nearest neighbor interpolator, zeroes, an average value or lead to the velocity being ignored.
This is based on the fill type that is set by the user.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xmid</strong> (<em>float</em>) – x-coordinate of center of local grid.</p></li>
<li><p><strong>ymid</strong> (<em>float</em>) – y-coordinate of center of local grid.</p></li>
<li><p><strong>extrap_from_A</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether or not NaNs should be extrapolated using data stored on the original mesh (A) or new mesh (B), by default True</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>_description_</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>_type_</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="local_variable_treatment.global_to_local_variables.get_local_grid_hull_points">
<span class="sig-name descname"><span class="pre">get_local_grid_hull_points</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tag</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#local_variable_treatment.global_to_local_variables.get_local_grid_hull_points" title="Permalink to this definition"></a></dt>
<dd><p>Get convex hull points defining the local grid.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tag</strong> (<em>int</em>) – source tag</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A set of points defining the convex hull of the local grid.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>array</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="local_variable_treatment.global_to_local_variables.get_local_meshes">
<span class="sig-name descname"><span class="pre">get_local_meshes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">origin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#local_variable_treatment.global_to_local_variables.get_local_meshes" title="Permalink to this definition"></a></dt>
<dd><p>Get local mesh centered around source given by tag, or around coordinates given by origin.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tag</strong> (<em>int</em>) – Integer for source which source to center the local mesh around.</p></li>
<li><p><strong>origin</strong> (<em>array</em><em> (</em><em>[</em><em>x</em><em>,</em><em>y</em><em>]</em><em>)</em><em>, </em><em>optional</em>) – Coordinate for where to center the local mesh if you do not want to use a specific source, by default None</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dictionary containing computational and output meshes that have been translated to the relevant coordinates.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="local_variable_treatment.global_to_local_variables.get_local_source">
<span class="sig-name descname"><span class="pre">get_local_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tag</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#local_variable_treatment.global_to_local_variables.get_local_source" title="Permalink to this definition"></a></dt>
<dd><p>Extract single source given a tag from dataset containing multiple sources.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sources</strong> (<em>xarray dataset</em>) – A xarray dataset containing sources</p></li>
<li><p><strong>tag</strong> (<em>int</em>) – What source to extract</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A xarray dataset containing a single source.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>xarray dataset</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="local_variable_treatment.global_to_local_variables.get_local_velocity">
<span class="sig-name descname"><span class="pre">get_local_velocity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">origin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extrap_from_A</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">view</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#local_variable_treatment.global_to_local_variables.get_local_velocity" title="Permalink to this definition"></a></dt>
<dd><p>Get a local velocity xarray dataset extracted from the global velocity.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tag</strong> (<em>int</em>) – What source to extract velocities around.</p></li>
<li><p><strong>origin</strong> (<em>array</em><em> (</em><em>[</em><em>x</em><em>,</em><em>y</em><em>]</em><em>)</em><em>, </em><em>optional</em>) – Location in space to extract velocities around, by default None.</p></li>
<li><p><strong>view</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether or not to plot and store the extracted velocity, by default False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An xarray dataset containing velocities from a local region around a source.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>xarray dataset</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="local_variable_treatment.global_to_local_variables.get_probe_locations">
<span class="sig-name descname"><span class="pre">get_probe_locations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tag</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#local_variable_treatment.global_to_local_variables.get_probe_locations" title="Permalink to this definition"></a></dt>
<dd><p>Get probe locations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>probes</strong> (<em>xarray dataset</em>) – A xarray dataset containing probe locations.</p></li>
<li><p><strong>source</strong> (<em>xarray dataset</em>) – A xarray dataset containing one source location.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A xarray dataset containing probe locations</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>xarray dataset</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="local_variable_treatment.global_to_local_variables.in_hull">
<span class="sig-name descname"><span class="pre">in_hull</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hull</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">query_points</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#local_variable_treatment.global_to_local_variables.in_hull" title="Permalink to this definition"></a></dt>
<dd><p>Check if query points are inside the convex hull defined by a set of points.
Thanks to the helpful people at <a class="reference external" href="https://stackoverflow.com/questions/16750618/whats-an-efficient-way-to-find-if-a-point-lies-in-the-convex-hull-of-a-point-cl">https://stackoverflow.com/questions/16750618/whats-an-efficient-way-to-find-if-a-point-lies-in-the-convex-hull-of-a-point-cl</a>
for the algorithm.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hull</strong> (<em>array</em><em> or </em><em>Delaunay object</em>) – An MxK array of M points in K dimensions of points defining a convex hull or a scipy.spatial.Delaunay object.</p></li>
<li><p><strong>query_points</strong> (<em>array</em>) – A set of points to query. Should be an NxK array coordinates of N points in K dimensions.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Boolean array.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>array</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="local_variable_treatment.global_to_local_variables.perform_fill_check">
<span class="sig-name descname"><span class="pre">perform_fill_check</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#local_variable_treatment.global_to_local_variables.perform_fill_check" title="Permalink to this definition"></a></dt>
<dd><p>Checks each local grid if any intersect with the exterior of the convex hull of the global velocity data. If so
warn the user which sources this affects.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="local_variable_treatment.global_to_local_variables.perform_probe_check">
<span class="sig-name descname"><span class="pre">perform_probe_check</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#local_variable_treatment.global_to_local_variables.perform_probe_check" title="Permalink to this definition"></a></dt>
<dd><p>Check if probes are inside the convex hull of the velocity data.
Any probes outside the convex hull will lead to a warning being printed.
If all probes are outside the convex hull, then probes will be set to None so that they can be ignored.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="local_variable_treatment.global_to_local_variables.perform_source_check">
<span class="sig-name descname"><span class="pre">perform_source_check</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#local_variable_treatment.global_to_local_variables.perform_source_check" title="Permalink to this definition"></a></dt>
<dd><p>Check if sources are inside convex hull of the velocity data.
Any sources outside the convex hull will lead to a warning being printed (as long as verbose is enabled).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="local_variable_treatment.global_to_local_variables.velocity_viewer">
<span class="sig-name descname"><span class="pre">velocity_viewer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'u'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'none'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#local_variable_treatment.global_to_local_variables.velocity_viewer" title="Permalink to this definition"></a></dt>
<dd><p>Viewer meant for debugging.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>xarray dataset</em>) – An xarray dataset containing velocity.</p></li>
<li><p><strong>time</strong> (<em>int</em>) – What timestep to plot.</p></li>
<li><p><strong>tag</strong> (<em>int</em>) – What source does the data belong to.</p></li>
<li><p><strong>variable</strong> (<em>str</em><em>, </em><em>optional</em>) – Which velocity component to plot, by default ‘u’.</p></li>
<li><p><strong>name</strong> (<em>str</em><em>, </em><em>optional</em>) – Name of output image, by default ‘none’.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="risk_to_positions.html" class="btn btn-neutral float-left" title="risk_to_positions module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="parser_tools.html" class="btn btn-neutral float-right" title="parser_tools module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, ACTOM.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>